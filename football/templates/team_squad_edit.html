{% extends 'base.html' %}
{% load static %}

{% block title %}–°–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã {{ team.name }}{% endblock %}

{% block content %}

<section class="team-header">
    <div class="team-header-logo">
        {% if team.emblem %}
            <img src="{% static 'emblems/' %}{{ team.emblem }}" alt="{{ team.name }}">
        {% else %}
            <span>{{ team.name|slice:":2"|upper }}</span>
        {% endif %}
    </div>
    <div class="team-header-main">
        <div class="team-header-title-line">
            <h1 class="team-header-name">{{ team.name }}</h1>
        </div>
        <div class="team-header-meta">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–∞ –∫–æ–º–∞–Ω–¥—ã
        </div>
    </div>
    <div class="team-header-actions">
        <a href="{% url 'team_detail' team.id %}" class="btn btn-ghost btn-small">
            ‚Üê –ù–∞–∑–∞–¥ –∫ –∫–æ–º–∞–Ω–¥–µ
        </a>
    </div>
</section>

<section class="form-panel">
    <div class="form-header">
        <h2 class="form-title">–°–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã</h2>
        <p class="form-subtitle">
            –ù–æ–º–µ—Ä–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏. –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã—Ö.
        </p>
    </div>

    {% if error_message %}
        <div class="form-errors" style="margin-bottom:10px;">
            {{ error_message }}
        </div>
    {% endif %}

    <form method="post">
        {% csrf_token %}

        <!-- –¢–ï–ö–£–©–ò–ô –°–û–°–¢–ê–í -->
        <div class="form-body">
            <div class="form-row">
                <label class="form-label">–¢–µ–∫—É—â–∏–π —Å–æ—Å—Ç–∞–≤</label>
                <div class="form-help">
                    –ò–∑–º–µ–Ω–∏ –Ω–æ–º–µ—Ä –∏–ª–∏ –ø–æ—Å—Ç–∞–≤—å –≥–∞–ª–æ—á–∫—É ¬´–£–¥–∞–ª–∏—Ç—å¬ª, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫–∞ –∏–∑ –∫–æ–º–∞–Ω–¥—ã.
                </div>
            </div>

            {% if squad %}
                <table class="table team-players-table">
                    <thead>
                        <tr>
                            <th style="width:80px;">–ù–æ–º–µ—Ä</th>
                            <th>–ò–≥—Ä–æ–∫</th>
                            <th>–ê–º–ø–ª—É–∞</th>
                            <th style="width:80px;">–£–¥–∞–ª–∏—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tp in squad %}
                            <tr>
                                <td>
                                    <input type="number"
                                           name="number_{{ tp.id }}"
                                           value="{{ tp.number|default_if_none:'' }}"
                                           class="form-input"
                                           style="max-width:110px; padding:8px 10px; font-size:14px;">
                                </td>
                                <td>
                                    <a href="{% url 'player_detail' tp.player.id %}" class="link">
                                        {{ tp.player.first_name }} {{ tp.player.last_name }}
                                    </a>
                                </td>
                                <td>
                                    {% if tp.player.position %}
                                        {{ tp.player.get_position_display }}
                                    {% else %}
                                        <span class="muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <label style="display:inline-flex; align-items:center; gap:4px; font-size:12px;">
                                        <input type="checkbox"
                                               name="remove_tp"
                                               value="{{ tp.id }}">
                                        <span>–£–¥–∞–ª–∏—Ç—å</span>
                                    </label>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="muted">–í —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤.</p>
            {% endif %}
        </div>

        <hr style="margin:16px 0; border:none; border-top:1px solid #e5e7eb;">

        <!-- –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–û–ì–û –ò–ì–†–û–ö–ê: –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–º–µ—Å—Ç–æ select -->
        <div class="form-body">
            <div class="form-row">
                <label class="form-label">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –≤ –∫–æ–º–∞–Ω–¥—É</label>
                <p class="form-help">
                    –°–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏ –∏–≥—Ä–æ–∫–∞ (–∫–∞—Ä—Ç–æ—á–∫–∞), —Å–ø—Ä–∞–≤–∞ –∑–∞–¥–∞–π –Ω–æ–º–µ—Ä –≤ –∫–æ–º–∞–Ω–¥–µ.
                    –°–ø–∏—Å–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã.
                </p>
            </div>

            <!-- —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ä–µ–∞–ª—å–Ω–æ —É—Ö–æ–¥–∏—Ç –≤–æ view -->
            <input type="hidden" name="new_player_id" id="id_new_player_id">

            {% if available_players %}
                <div class="player-grid">
                    {% for p in available_players %}
                        <div class="player-card"
                             data-player-id="{{ p.id }}">
                            <div class="player-card-header">
                                <div class="player-card-name">
                                    {{ p.first_name }} {{ p.last_name }}
                                </div>
                                <div class="player-card-tag">
                                    {% if p.position %}
                                        {{ p.get_position_display }}
                                    {% else %}
                                        –ë–µ–∑ –ø–æ–∑–∏—Ü–∏–∏
                                    {% endif %}
                                </div>
                            </div>
                            <div class="player-card-meta">
                                –°–≤–æ–±–æ–¥–Ω—ã–π –∏–≥—Ä–æ–∫
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="muted">
                    –°–≤–æ–±–æ–¥–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å–µ–π—á–∞—Å –Ω–µ—Ç ‚Äì –≤—Å–µ —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–º–∞–Ω–¥–∞–º.
                </p>
            {% endif %}

            <div class="form-row" style="margin-top:10px; max-width:180px;">
                <label class="form-label" for="id_new_player_number">–ù–æ–º–µ—Ä –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</label>
                <input type="number"
                       name="new_player_number"
                       id="id_new_player_number"
                       class="form-input"
                       style="padding:8px 10px; font-size:14px;"
                       placeholder="10">
                <p class="form-help">–ù–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–æ–±–æ–¥–µ–Ω –≤ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.</p>
            </div>
        </div>

        <div class="form-footer">
            <span class="muted">
                –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è —Å—Ä–∞–∑—É –∫–æ –≤—Å–µ–π –∑–∞—è–≤–∫–µ –∫–æ–º–∞–Ω–¥—ã.
            </span>
            <button type="submit" class="btn btn-primary">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–∞–≤
            </button>
        </div>
    </form>
</section>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const cards = document.querySelectorAll('.player-card[data-player-id]');
    const hidden = document.getElementById('id_new_player_id');

    cards.forEach(card => {
        card.addEventListener('click', () => {
            cards.forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            hidden.value = card.dataset.playerId;
        });
    });
});
</script>

{% endblock %}
